<!DOCTYPE html>
<html>
<head>
  <title>Book Hotel | Alingo</title>
</head>
<body>

<h2>Book a Hotel</h2>

<select id="hotelSelect"></select><br/><br/>
<input type="date" id="checkIn" placeholder="Check-in Date" required /><br/>
<input type="date" id="checkOut" placeholder="Check-out Date" required /><br/>
<input type="number" id="rooms" placeholder="Rooms to Book" min="1" required /><br/>
<button onclick="bookHotel()">Book</button>

<script>
async function loadHotels() {
  const token = localStorage.getItem("token");
  const res = await fetch("/api/hotel/all", { headers: { "Authorization": `Bearer ${token}` } });
  const data = await res.json();
  
  const select = document.getElementById("hotelSelect");
  data.hotels.forEach(h => {
    const opt = document.createElement("option");
    opt.value = h._id;
    opt.text = `${h.name} | ${h.location} | $${h.pricePerNight}/night | Rooms Available: ${h.roomsAvailable}`;
    select.appendChild(opt);
  });
}

async function bookHotel() {
  const token = localStorage.getItem("token");
  const hotelId = document.getElementById("hotelSelect").value;
  const checkInDate = document.getElementById("checkIn").value;
  const checkOutDate = document.getElementById("checkOut").value;
  const roomsBooked = parseInt(document.getElementById("rooms").value);

  const res = await fetch("/api/hotel/book", {
    method: "POST",
    headers: { 
      "Content-Type": "application/json",
      "Authorization": `Bearer ${token}`
    },
    body: JSON.stringify({ hotelId, checkInDate, checkOutDate, roomsBooked })
  });

  const data = await res.json();
  alert("Booking Successful! ID: " + data.booking._id);
  window.location.href = "hotel-history.html";
}

loadHotels();
</script>

</body>
</html>
