<!DOCTYPE html>
<html>
<body>

<h2>Login</h2>

<input id="phone" placeholder="+92xxxxxxxxxx">
<button onclick="sendOTP()">Send OTP</button>

<div id="otpBox" style="display:none">
  <input id="otp" placeholder="OTP">
  <button onclick="verify()">Verify</button>
</div>

<div id="recaptcha"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_DOMAIN"
});

window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier("recaptcha");

let confirm;

function sendOTP(){
  firebase.auth().signInWithPhoneNumber(
    document.getElementById("phone").value,
    recaptchaVerifier
  ).then(r=>{
    confirm = r;
    document.getElementById("otpBox").style.display="block";
  });
}

function verify(){
  confirm.confirm(document.getElementById("otp").value)
    .then(async r=>{
      const idToken = await r.user.getIdToken();
      const res = await fetch("/api/otp/verify",{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ token:idToken })
      });
      const data = await res.json();
      localStorage.setItem("token",data.token);
      location.href="/home.html";
    });
}
</script>

</body>
</html>
