<script defer>
document.addEventListener("DOMContentLoaded", function() {
  const token = localStorage.getItem("token");
  if(!token){
    alert("Please login first");
    window.location.href = "/login.html";
    return;
  }

  // Greet user
  const greetEl = document.getElementById("greet");
  if(greetEl) greetEl.textContent = "Welcome, User!";

  // Show current rides
  const rideListEl = document.getElementById("rideList");
  if(rideListEl){
    fetch("/api/ride/my", {
      headers: { "Authorization": "Bearer " + token }
    })
    .then(res => res.json())
    .then(data => {
      rideListEl.innerHTML = "";
      if(!data || data.length === 0){
        rideListEl.innerHTML = "<li>No rides yet</li>";
      } else {
        data.forEach(r=>{
          const li = document.createElement("li");
          li.textContent = `${r.pickup} â†’ ${r.drop} | Status: ${r.status}`;
          rideListEl.appendChild(li);
        });
      }
    })
    .catch(err => {
      console.error("Ride fetch error:", err);
    });
  }
});
</script>
