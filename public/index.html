<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AlinGo Ride</title>

<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#1a237e">

<style>
:root{
  --indigo:#1a237e;
  --indigo-dark:#0d1440;
  --green:#2ecc71;
  --bg:#f5f7fa;
}

*{margin:0;padding:0;box-sizing:border-box;}

body{
  font-family: system-ui, Arial, sans-serif;
  background:var(--bg);
}

/* ===== HEADER ===== */
.header{
  background:var(--indigo);
  color:#fff;
  padding:14px;
  display:flex;
  align-items:center;
  gap:15px;
  position: fixed;
  width: 100%;
  top:0;
  z-index:5;
}

.menu-btn{
  font-size:24px;
  cursor:pointer;
}

.logo{
  height:38px;
}

/* ===== SIDEBAR ===== */
.sidebar{
  position:fixed;
  top:0;
  left:-260px;
  width:260px;
  height:100%;
  background:var(--indigo-dark);
  color:#fff;
  transition:.3s;
  padding:20px;
  z-index:10;
}

.sidebar.active{left:0;}

.sidebar img{
  width:120px;
  margin-bottom:30px;
}

.sidebar a{
  display:block;
  padding:14px;
  color:#fff;
  text-decoration:none;
  border-radius:8px;
  margin-bottom:10px;
  cursor: pointer;
}

.sidebar a:hover{
  background:var(--green);
  color:#0d1440;
}

/* ===== MAIN ===== */
.main{
  padding:80px 20px 20px 20px;
  transition:.3s;
}

.page{display:none;}
.page.active{display:block;}

/* ===== CARDS ===== */
.card{
  background:#fff;
  padding:20px;
  border-radius:16px;
  margin-bottom:20px;
  box-shadow:0 6px 18px rgba(0,0,0,.1);
}

.card button{
  margin-top:12px;
  width:100%;
  padding:14px;
  border:none;
  border-radius:10px;
  background:var(--green);
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}

.card button:hover{opacity:.9;}

/* Addition: Input Styling */
input{
  width: 100%;
  padding: 12px;
  margin: 8px 0;
  border: 1px solid #ddd;
  border-radius: 8px;
}
</style>
</head>

<body>

<div class="sidebar" id="sidebar">
  <div class="close-btn" onclick="toggleMenu()">&times;</div> <img src="LOGO.JPG" alt="Logo">
  
  <a onclick="openPage('home')">üè† Home</a>
  <a onclick="openPage('ride')">üöó Ride</a>
  <a onclick="openPage('food')">üçî Food</a>
  <a onclick="openPage('hotel')">üè® Hotel</a>
  <a onclick="openPage('ticket')">üé´ Tickets</a>
  <a onclick="openPage('wallet')">üí≥ Wallet</a>
  <a onclick="openPage('support')">üÜò Support</a>
  <a onclick="openPage('Investor')"> Investor</a>
  <a onclick="logout()" style="color: #ff4d4d;">üö™ Logout</a>
</div>

<div class="header">
  <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
  <img src="LOGO.JPG" class="logo">
  <h3>AlinGo Ride</h3>
</div>

<div class="main">

  <div id="home" class="page active">
    <div class="card">
      <h2>Ride with Confidence</h2>
      <p>Indrive-style freedom & transparency</p>
      <button onclick="openPage('ride')">Book Ride</button>
      <button id="installBtn" style="display:none; background: var(--indigo); color: white;">‚¨áÔ∏è Install App</button>
    </div>

    <div class="card">
      <h2>Order Food</h2>
      <button onclick="openPage('food')">Order Now</button>
    </div>

    <div class="card">
      <h2>Hotel Booking</h2>
      <button onclick="openPage('hotel')">Book Hotel</button>
    </div>

    <div class="card">
      <h2>Tickets & Tours</h2>
      <button onclick="openPage('ticket')">Buy Tickets</button>
    </div>
  </div>

  <div id="ride" class="page">
    <div class="card">
      <h2>Book a Ride</h2>
      <input id="pickup" placeholder="Pickup Location"><br>
      <input id="drop" placeholder="Drop Location">
      <button onclick="requestRide()">Request Ride</button>
    </div>
  </div>

  <div id="food" class="page">
    <div class="card"><h2>Food Module</h2><p>Coming Soon...</p></div>
  </div>

  <div id="hotel" class="page">
    <div class="card"><h2>Hotel Booking</h2><p>Coming Soon...</p></div>
  </div>

  <div id="ticket" class="page">
    <div class="card">
      <h2>Ticketing</h2>
      <input id="tName" placeholder="Ticket Name">
      <button onclick="bookTicket()">Book Now</button>
      <div id="ticketList" style="margin-top:20px;"></div>
    </div>
  </div>

  <div id="wallet" class="page">
    <div class="card">
      <h2>Wallet & Payments</h2>
      <p>Your Current Balance:</p>
      <h1 id="balanceDisplay">$0.00</h1>
    </div>
  </div>

  <div id="support" class="page">
    <div class="card"><h2>Help & Support</h2></div>
  </div>

</div>

<script>
// Global Token
const token = localStorage.getItem("token");

// Sidebar toggle
function toggleMenu(){
  document.getElementById("sidebar").classList.toggle("active");
}

// Page switch (Enhanced with Backend Connection)
async function openPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  if(document.getElementById("sidebar").classList.contains("active")) toggleMenu();

  // Authentication Check
  if(!token && id !== 'home'){
    alert("Please login first!");
    return;
  }

  // Auto-fetch data
  if(id === 'wallet') fetchBalance();
  if(id === 'ticket') fetchTickets();
}

/* === BACKEND ADDITIONS (GLUE CODE) === */

async function requestRide(){
  const pickup = document.getElementById("pickup").value;
  const drop = document.getElementById("drop").value;
  const res = await fetch("/api/rides/create", {
    method: "POST",
    headers: { "Content-Type":"application/json", "Authorization": `Bearer ${token}` },
    body: JSON.stringify({ pickupLocation: pickup, dropLocation: drop })
  });
  const data = await res.json();
  if(data.success) alert("Ride Request Sent!");
}

async function bookTicket(){
  const name = document.getElementById("tName").value;
  const res = await fetch("/api/ticket/book", {
    method: "POST",
    headers: { "Content-Type":"application/json", "Authorization": `Bearer ${token}` },
    body: JSON.stringify({ ticketName: name })
  });
  if(res.ok) { alert("Booked!"); fetchTickets(); }
}

async function fetchTickets(){
  const res = await fetch("/api/ticket/list", { headers: { "Authorization": `Bearer ${token}` } });
  const tickets = await res.json();
  const list = document.getElementById("ticketList");
  list.innerHTML = tickets.map(t => `<p>üé´ ${t.ticketName} - <b>${t.status}</b></p>`).join('');
}

async function fetchBalance(){
  const res = await fetch("/api/wallet/balance", { headers: { "Authorization": `Bearer ${token}` } });
  const data = await res.json();
  if(data.success) document.getElementById("balanceDisplay").innerText = `$${data.balance.toFixed(2)}`;
}

function logout(){ localStorage.clear(); window.location.reload(); }

/* === PWA LOGIC (AS PROVIDED BY YOU) === */
let deferredPrompt;
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/service-worker.js')
    .then(()=>console.log('Service Worker Registered'))
    .catch(e=>console.log('SW Error:',e));
}

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  // Make the button visible
  document.getElementById('installBtn').style.display = 'block';
});

document.getElementById('installBtn').addEventListener('click', async () => {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  const choiceResult = await deferredPrompt.userChoice;
  if (choiceResult.outcome === 'accepted') {
    console.log('User accepted the install prompt');
  }
  deferredPrompt = null;
  document.getElementById('installBtn').style.display = 'none';
});
</script>

</body>
</html>
